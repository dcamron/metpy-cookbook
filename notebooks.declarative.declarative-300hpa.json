{"version":2,"kind":"Notebook","sha256":"876e8ea241dd15b446f310b7a4ec4ccaea7512ddca1ac3274e0b71a8471ce48f","slug":"notebooks.declarative.declarative-300hpa","location":"/notebooks/declarative/Declarative_300hPa.ipynb","dependencies":[],"frontmatter":{"title":"MetPy Declarative - 300 hPa","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"MetPy Maintainers","given":"MetPy","family":"Maintainers"},"name":"MetPy Maintainers","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/metpy-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/projectpythia/metpy-cookbook/blob/main/notebooks/declarative/Declarative_300hPa.ipynb","exports":[{"format":"ipynb","filename":"Declarative_300hPa.ipynb","url":"/metpy-cookbook/build/Declarative_300hPa-641ac6ff55bbda0398f869edfb63df75.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"cell_marker":"\"\"\""},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"By: Kevin Goebbert","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zTWaao9YpE"}],"key":"QVjVd172rV"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"This example uses the declarative syntax available through the MetPy\npackage to allow a more convenient method for creating simple maps of\natmospheric data. The key thing the declarative language does is to\nreduce the number of packages that users will need to know in detail and\ninstead allow them to set key parameters to get the map they desire. One\nkey element is the use of xarray as the data object, which allows\ncoordinate information to be associated with atmospheric variables.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"z4MboFFJsv"}],"key":"hlL2y9tyF4"}],"key":"IsTDt7XoFw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime\n\nimport metpy.calc as mpcalc\nfrom metpy.plots.declarative import *\nfrom metpy.units import units\nimport xarray as xr","key":"ywfmybBuPo"},{"type":"output","id":"dK6id5W_UPqx1kmoU3X38","data":[],"key":"oKh6YAQhTW"}],"key":"uDOHkbfCq3"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Open dataset using xarray module and subset global GFS to be over the\nCONUS.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yxek6XOudC"}],"key":"hKdeDoccns"}],"key":"N9tr5Zrq3z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = xr.open_dataset('https://thredds.ucar.edu/thredds/dodsC/casestudies'\n                     '/python-gallery/GFS_20101026_1200.nc').sel(\n    lon=slice(360-150, 360-50, 2), lat=slice(65, 20, 2))","key":"tpOlxAkjTd"},{"type":"output","id":"iGdFVtGRANITdOL1sWOsb","data":[],"key":"Y5AaS5tKYd"}],"key":"zjPe0Dt4Os"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Calculate Variable and Add to Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NVzPWWH2H4"}],"identifier":"calculate-variable-and-add-to-dataset","label":"Calculate Variable and Add to Dataset","html_id":"calculate-variable-and-add-to-dataset","implicit":true,"key":"UWEIj66pqb"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Here it is demonstrated how you can calculate a new variable and add it\nto the xarray dataset (ds) so that it can be plotted with the\ndeclarative syntax. The key to adding a variable to an xarray dataset\nfor use in the declarative syntax is the need to add a ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FbPlNHxl9x"},{"type":"inlineCode","value":"grid_mapping","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zCN8fGvOrM"},{"type":"text","value":"\nand ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"J5cKKDRmn7"},{"type":"inlineCode","value":"units","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AaS7Kuy6ql"},{"type":"text","value":" attribute.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"D4rYwYHmdQ"}],"key":"VV0W5Py9YU"}],"key":"ztb0e1nCHZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate New Variables and place into Xarray Dataset\nuwnd = ds['u-component_of_wind_isobaric']\nvwnd = ds['v-component_of_wind_isobaric']\n\n# Compute wind speed using MetPy\nwspd = mpcalc.wind_speed(uwnd, vwnd)\n\n# Place wind speed (wspd) into xarray dataset and attach needed attributes\nds['wind_speed'] = wspd","key":"odM00voK7X"},{"type":"output","id":"hQYD6hV_hRWbnfL8TqkXI","data":[],"key":"n5foRQYpmF"}],"key":"HmClEasoqK"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Declarative Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c5VDgBXy57"}],"identifier":"declarative-plot","label":"Declarative Plot","html_id":"declarative-plot","implicit":true,"key":"pbt3i5GzOJ"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The following settings create a single panel map plot of 300 hPa\ngeopotential heights, wind speed, and wind barbs.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"llzcTCQC2P"}],"key":"wEF4hExiMB"}],"key":"HqI9c2s5tC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Countour Plot of Geopotential Heights\ncontour = ContourPlot()\ncontour.data = ds\ncontour.time = datetime(2010, 10, 31, 12)\ncontour.field = 'Geopotential_height_isobaric'\ncontour.level = 300 * units.hPa\ncontour.linecolor = 'black'\ncontour.linestyle = '-'\ncontour.linewidth = 2\ncontour.clabels = True\ncontour.contours = list(range(0, 20000, 120))\n\n# Colorfilled Plot of Wind Speed\ncfill = FilledContourPlot()\ncfill.data = ds\ncfill.field = 'wind_speed'\ncfill.level = 300 * units.hPa\ncfill.colormap = 'BuPu'\ncfill.contours = list(range(50, 171, 20))\ncfill.colorbar = 'vertical'\ncfill.plot_units = 'kt'\n\n# Plot wind barbs\nbarb = BarbPlot()\nbarb.data = ds\nbarb.level = 300 * units.hPa\nbarb.field = ['u-component_of_wind_isobaric', 'v-component_of_wind_isobaric']\nbarb.skip = (3, 3)\nbarb.color = 'black'\nbarb.barblength = 6.5\nbarb.earth_relative = False\nbarb.plot_units = 'kt'\n\n# Panel for plot with Map features\npanel = MapPanel()\npanel.layout = (1, 1, 1)\npanel.area = (-124, -72, 20, 53)\npanel.projection = 'lcc'\npanel.layers = ['coastline', 'borders', 'states', 'land']\npanel.plots = [cfill, contour, barb]\n\n# Bringing it all together\npc = PanelContainer()\npc.size = (15, 9)\npc.panels = [panel]\n\npc.show()","key":"vlOXIeVygL"},{"type":"output","id":"HusECM5bRA1ReWPeewBu-","data":[{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/metpy-cookbook/lib/python3.13/site-packages/cartopy/io/__init__.py:242: DownloadWarning: Downloading: https://naturalearth.s3.amazonaws.com/50m_physical/ne_50m_land.zip\n  warnings.warn(f'Downloading: {url}', DownloadWarning)\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/metpy-cookbook/lib/python3.13/site-packages/cartopy/io/__init__.py:242: DownloadWarning: Downloading: https://naturalearth.s3.amazonaws.com/50m_cultural/ne_50m_admin_0_boundary_lines_land.zip\n  warnings.warn(f'Downloading: {url}', DownloadWarning)\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x900 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7e6c9cbbd6714156dee889278f7eae4e","path":"/metpy-cookbook/build/7e6c9cbbd6714156dee889278f7eae4e.png"}}}],"key":"rMKLIeF6XQ"}],"key":"ThnUwiUlqB"}],"key":"NNq7Jqizal"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"MetPy’s Simplified Plotting Interface","url":"/notebooks/declarative","group":"The MetPy Gallery"},"next":{"title":"Declarative 500-hPa Absolute Vorticity","url":"/notebooks/declarative/declarative-500-hpa","group":"The MetPy Gallery"}}},"domain":"http://localhost:3000"}