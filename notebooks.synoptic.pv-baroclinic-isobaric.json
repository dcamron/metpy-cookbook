{"version":2,"kind":"Notebook","sha256":"647d1553c6aee43b2aab85ed2dbc6d9843b71942b0515178ae7e3457a7582bde","slug":"notebooks.synoptic.pv-baroclinic-isobaric","location":"/notebooks/synoptic/PV_baroclinic_isobaric.ipynb","dependencies":[],"frontmatter":{"title":"Baroclinic Potential Vorticity Analysis, Divergence, and Winds","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"MetPy Maintainers","given":"MetPy","family":"Maintainers"},"name":"MetPy Maintainers","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/metpy-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/projectpythia/metpy-cookbook/blob/main/notebooks/synoptic/PV_baroclinic_isobaric.ipynb","exports":[{"format":"ipynb","filename":"PV_baroclinic_isobaric.ipynb","url":"/metpy-cookbook/build/PV_baroclinic_isobar-067565fbb04fa232d07e52a6c2a8e051.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"cell_marker":"\"\"\""},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Classic baroclinic potential vorticity plot at 250 hPa using GFS\nanalysis file.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hiePTrDVSL"}],"key":"YA9aOifUIq"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"This example uses example data from the GFS analysis for 12 UTC 31\nOctober 2016 and uses xarray as the main read source with using MetPy to\ncalculate the baroclinic potential vorticity, divergence and wind speed\nwith geographic plotting using Cartopy for a CONUS view of the 250-hPa\nsurface with divergence and wind barbs.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"McNC8N7PLc"}],"key":"UXyVgGB7Ar"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"By: Kevin Goebbert","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"oRGhSCPoaa"}],"key":"cDyin8DtI8"}],"key":"jCcQO5gRue"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import cartopy.crs as ccrs\nimport cartopy.feature as cfeature\nimport matplotlib.pyplot as plt\nimport metpy.calc as mpcalc\nfrom metpy.units import units\nimport numpy as np\nimport xarray as xr","key":"gvQFEuM620"},{"type":"output","id":"qIqJynfQf-p-jDCg38yq0","data":[],"key":"aP4r7e6XBD"}],"key":"KnRs3dyoDP"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The following code reads the example data using the xarray open_dataset\nfunction and prints the coordinate values that are associated with the\nvarious variables contained within the file.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J4PkRsZKwI"}],"key":"oLh8rC713G"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This code uses the metpy accessor to parse file to make it easy to pull\ndata using common coordinate names (e.g., vertical) and attach units.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QBcBwvqXiF"}],"key":"hxtQdtEVZw"}],"key":"MSjvRZXnpP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = xr.open_dataset('https://thredds.ucar.edu/thredds/dodsC/casestudies'\n                     '/python-gallery/GFS_20101026_1200.nc').metpy.parse_cf()","key":"aumxXKLC1N"},{"type":"output","id":"aX0iKU0A3rH4S0PlB9nj1","data":[{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"},{"output_type":"stream","name":"stderr","text":"Could not find variable corresponding to the value of grid_mapping: LatLon_Projection\n"}],"key":"Jxihn4iyou"}],"key":"H5FEyI3Lcu"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Data Retrieval","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cRVxLBGW3Q"}],"identifier":"data-retrieval","label":"Data Retrieval","html_id":"data-retrieval","implicit":true,"key":"Oh7mfQqtRP"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This code retrieves the necessary data from the file and completes some\nsmoothing of the temperature, and wind fields using the MetPy function\nsmooth_n_point. A nicely formated valid time (vtime) variable is also\ncreated.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fipzX7Sddm"}],"key":"jBYcW8cxjK"}],"key":"OyiPCGJzbD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set subset slice for the geographic extent of data to limit download\nlon_slice = slice(200, 350)\nlat_slice = slice(85, 10)\n\n# Grab lat/lon values (GFS will be 1D)\nlats = ds.lat.sel(lat=lat_slice).values\nlons = ds.lon.sel(lon=lon_slice).values\n\n\n# Grab the pressure levels and select the data to be imported\n# Need all pressure levels for Temperatures, U and V Wind,\n# and Rel. Humidity\n# Smooth with the gaussian filter from scipy\npres = ds.Temperature_isobaric.metpy.vertical\n\ntmpk_var = ds['Temperature_isobaric'].metpy.sel(\n    lat=lat_slice, lon=lon_slice).squeeze()\ntmpk = mpcalc.smooth_n_point(tmpk_var, 9, 2)\nthta = mpcalc.potential_temperature(pres, tmpk)\n\nuwnd_var = ds['u-component_of_wind_isobaric'].metpy.sel(\n    lat=lat_slice, lon=lon_slice).squeeze()\nvwnd_var = ds['v-component_of_wind_isobaric'].metpy.sel(\n    lat=lat_slice, lon=lon_slice).squeeze()\nuwnd = mpcalc.smooth_n_point(uwnd_var, 9, 2)\nvwnd = mpcalc.smooth_n_point(vwnd_var, 9, 2)\n\n# Create a clean datetime object for plotting based on time of\n# Geopotential heights\nvtime = ds.time.data[0].astype('datetime64[ms]').astype('O')","key":"ZghPQAgxGI"},{"type":"output","id":"Bl5IhvXtanALUQ3Fha6Py","data":[],"key":"Ngrms99bYG"}],"key":"npwFyGgGY8"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Use MetPy to compute the baroclinic potential vorticity on all isobaric\nlevels and other variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EvmTMXKBSq"}],"key":"B02OhiCeYL"}],"key":"Ykjq8w4fqJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Comput the PV on all isobaric surfaces\npv = mpcalc.potential_vorticity_baroclinic(thta, pres, uwnd, vwnd)\n\n# Use MetPy to compute the divergence on the pressure surfaces\ndiv = mpcalc.divergence(uwnd, vwnd)\n\n# Select the 250-hPa surface\npv_250 = pv.metpy.sel(vertical=250*units.hPa)\ndiv_250 = div.metpy.sel(vertical=250*units.hPa)\nuwnd_250 = uwnd.metpy.sel(vertical=250*units.hPa)\nvwnd_250 = vwnd.metpy.sel(vertical=250*units.hPa)","key":"ADrmDeCJoM"},{"type":"output","id":"IKXjQ0xMMsPcROwJpj9aw","data":[],"key":"nhLXpGgPyE"}],"key":"jSAUxPMH03"},{"type":"block","kind":"notebook-content","data":{"cell_marker":"######################################################################"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Map Creation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N9EfOoKTey"}],"identifier":"map-creation","label":"Map Creation","html_id":"map-creation","implicit":true,"key":"zFmErdpXtV"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This next set of code creates the plot and draws contours on a Lambert\nConformal map centered on -100 E longitude. The main view is over the\nCONUS with isobaric PV map with PV contoured every 1 PVU and divergence\ncolorshaded.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qPn0OI6Uap"}],"key":"MUSoMxUlPY"}],"key":"HkUG5qjoXr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set up the projection that will be used for plotting\nmapcrs = ccrs.LambertConformal(central_longitude=-100,\n                               central_latitude=35,\n                               standard_parallels=(30, 60))\n\n# Set up the projection of the data;\n# if lat/lon then PlateCarree is what you want\ndatacrs = ccrs.PlateCarree()\n\n# Start the figure and create plot axes with proper projection\nfig = plt.figure(1, figsize=(14, 12))\nax = plt.subplot(111, projection=mapcrs)\nax.set_extent([-130, -72, 20, 55], ccrs.PlateCarree())\n\n# Add geopolitical boundaries for map reference\nax.add_feature(cfeature.COASTLINE.with_scale('50m'))\nax.add_feature(cfeature.STATES.with_scale('50m'))\n\n# Plot the contours of PV at 250 hPa, scaling 10^6 every 1 PVU\nclevs_pv = np.arange(0, 25, 1)\ncs1 = ax.contour(lons, lats, pv_250*1e6, clevs_pv, colors='black',\n                 transform=datacrs)\nplt.clabel(cs1, fmt='%d', fontsize='large')\n\n# Plot the colorfill of divergence, scaled 10^5 every 1 s^1\nclevs_div = np.arange(-15, 16, 1)\ncs1 = ax.contourf(lons, lats, div_250*1e5, clevs_div, cmap=plt.cm.PuOr,\n                  extend='both', transform=datacrs)\nplt.colorbar(cs1, orientation='horizontal', pad=0, aspect=50, extendrect=True)\n\n# Plot the wind barbs at 250 hPa\nwind_slice = slice(None, None, 6)\nax.barbs(lons[wind_slice], lats[wind_slice],\n         uwnd_250[wind_slice, wind_slice].metpy.convert_units('kt').values,\n         vwnd_250[wind_slice, wind_slice].metpy.convert_units('kt').values,\n         pivot='middle', color='black', length=6.5, transform=datacrs)\n\n# Plot some titles to tell people what is on the map\nplt.title('250-hPa GFS PV (PVU), Divergence ($10^5$ s$^{-1}$),'\n          ' and Wind Barbs (kt)', loc='left')\nplt.title(f'Valid Time: {vtime}', loc='right')","key":"cLPRHEbLuf"},{"type":"output","id":"Xe0lGbfveeG4BY17df82V","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1400x1200 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9a2885ac97873d801b10b459f3290b71","path":"/metpy-cookbook/build/9a2885ac97873d801b10b459f3290b71.png"}}}],"key":"gWN8ue5uE1"}],"key":"ZmiChLONF3"}],"key":"KnfirgShUQ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Isentropic Analysis","url":"/notebooks/synoptic/isentropic-interpolation","group":"The MetPy Gallery"},"next":{"title":"DIFAX Replication","url":"/notebooks/synoptic/upperair-obs","group":"The MetPy Gallery"}}},"domain":"http://localhost:3000"}